<html>

<head>
	<meta charset="utf-8">
	<title>Tutorial: Hello Dojo!</title>
	<script src="dojo.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.7.0/nv.d3.min.css" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://d3plus.org/js/d3.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.7.0/nv.d3.min.js"></script>
</head>

<body id="body">
	<h1 id="greeting">Dojo Test Visualisation</h1>

	<div id="vis">
		<div id="discretebarchart">
			<svg style="width:450px;height:450px;"></svg>
		</div>

		<div id="piechart">
			<svg style="width:450px;height:450px;"></svg>
		</div>
		<div id="multibarchart">
			<svg style="width:450px;height:450px;"></svg>
		</div>

		<script>
			require(["dojo/request/xhr", "dojo/dom-construct", "dojo/dom", "dojo/on", "dojo/domReady!"], function (xhr, domConstruct, dom, on) {
				xhr("http://its-dev04.infradev.dev.laval.l121:9000/pie_chart", {
					handleAs: "json"
				}).then(function (data) {
					var script = domConstruct.toDom(data.script);
					domConstruct.place(script, "vis");
					eval(script.innerHTML);
				},
					function (err) {
					},
					function (evt) {
					});
			});

			require(["dojo/request/xhr", "dojo/dom-construct", "dojo/dom", "dojo/on", "dojo/domReady!"], function (xhr, domConstruct, dom, on) {
				xhr("http://its-dev04.infradev.dev.laval.l121:9000/multiBar_chart", {
					handleAs: "json"
				}).then(function (data) {
					var script = domConstruct.toDom(data.script);
					domConstruct.place(script, "vis");
					eval(script.innerHTML);
				},
					function (err) {
					},
					function (evt) {
					});
			});

			require(["dojo/request/xhr", "dojo/dom-construct", "dojo/dom", "dojo/on", "dojo/domReady!"], function (xhr, domConstruct, dom, on) {
				xhr("http://its-dev04.infradev.dev.laval.l121:9000/discreteBar_chart", {
					handleAs: "json"
				}).then(function (data) {
					var script = domConstruct.toDom(data.script);
					domConstruct.place(script, "vis");
					eval(script.innerHTML);
				},
					function (err) {
					},
					function (evt) {
					});
			});


			require(["dojo/request/xhr", "dojo/dom-construct", "dojo/on", "dojo/dom", "dojo/json", "dojo/domReady!"],
				function (xhr, on, dom, domConstruct, JSON) {

					xhr("http://its-dev04.infradev.dev.laval.l121:9000/pieChart_filtered", {
						handleAs: "json",
						data: JSON.stringify("SELECT tls201_appln.docdb_family_id, tls201_appln.earliest_publn_year FROM (((tls201_appln LEFT OUTER JOIN tls209_appln_ipc ON tls201_appln.appln_id = tls209_appln_ipc.appln_id ) LEFT OUTER JOIN tls207_pers_appln ON tls201_appln.appln_id = tls207_pers_appln.appln_id ) LEFT OUTER JOIN tls206_person ON tls207_pers_appln.person_id = tls206_person.person_id) INNER JOIN ( SELECT TOP 10000 * FROM tls201_appln) AS res ON res.appln_id = tls201_appln.appln_id"),
						//headers: {'Content-Type':'text/plain'},
						headers: { 'Content-Type': 'application/json' },
						method: 'POST'
					}).then(function (data) {
						console.log(data);
					}, function (err) {
						// Handle the error condition
						console.error(err);
					}, function (evt) {
						// Handle a progress event from the request if the
						// browser supports XHR2
					});
				});

		</script>
	</div>
</body>

</html>